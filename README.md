# StoryAgents

A multi-agent, role-playing story generation system powered by LLMs. Agents with distinct personalities interact in a fantasy world, collaboratively advancing a story and producing a polished narrative summary.

## Features

- **Multi-agent interaction**: Agents (e.g., royal advisor, forest shaman, mountain chieftain) each have unique personas and abilities.
- **World rules**: The story unfolds in a fantasy world with its own logic and lore.
- **Dynamic controller**: A controller agent decides which character acts next, encouraging rich, multi-party dialogue.
- **Automated summarization**: After a set number of turns, a summarizer agent produces a coherent, emotionally rich story.
- **Logging**: All actions and agent turns are logged for transparency and debugging.

## Quick Start

### 1. Clone the repository

```bash
git clone https://github.com/LC-John/StoryAgents.git
cd StoryAgents
```

### 2. Install dependencies

We recommend using uv.

```bash
uv sync
```

### 3. Set up environment variables

Create a `.env` file in the project root with your DeepSeek API key:

```bash
DEEPSEEK_API_KEY=your_deepseek_api_key_here
```

### 4. Run the project

```bash
python main.py
```

The story will be generated in the console, and logs will be saved to `story_agents.log`.

## A Demonstrative Story

Ten rounds of role playing looks like...

```plaintext
*手持缠绕着藤蔓的法杖，从阴影中缓步走出，兜帽下的双眼闪烁着微光*

**这片土地在低语...那件物品并非偶然出现在此地。它选择在此刻现身，就像春天的第一朵花选择绽放的时机。**

*轻轻触碰地面，几株荧光蘑菇随即在脚边生长*

**我们森林的子民知晓一个真理 - 强行占有只会带来灾祸。让物品自己选择它的归宿吧。**

*抬头望向其他势力的代表，声音如同林间微风*

**我提议举行古老的择主仪式。让大地之灵来决定。**
*双手抱胸，铁甲在阳光下闪着寒光，浓密的胡须随着冷笑抖动*

**哈！森林的软蛋又在念叨那些神神叨叨的玩意儿了！**

*重重踏前一步，地面微微震动*

**我们山地人只相信一个真理 - 强者才配拥有宝物！什么择主仪式，不过是懦夫的遮羞布！**

*从腰间抽出刻满符文的战斧，斧刃泛着暗红色的光芒*

**要我说，就该用我们祖先的方式 - 比武决胜！让战斧和铁锤来决定谁有资格带走这玩意儿！**

*突然转向王国代表，眯起眼睛*

**你们那些穿着丝绸的贵族老爷该不会也想用文书和条约来解决问题吧？**
*优雅地向前迈出一步，长袍上的金线在阳光下闪烁，双手交叠置于身前*

**诸位尊贵的代表，请容我以王国的名义发言。**

*微微颔首，目光在森林使者和山地战士之间流转*

**我们确实重视传统与秩序，但绝非如山地勇士所言那般迂腐。**

*从袖中取出一卷泛黄的羊皮纸*

**根据古代盟约记载，在类似情况下，我们的祖先曾采用过'三圣试炼' - 智慧、力量与心灵的考验。这既能尊重森林的择主传统，也能满足山地部落对实力的崇尚。**

*将羊皮卷轻轻展开，露出上面闪烁的魔法符文*

**更重要的是...**

*突然压低声音，眼神变得凝重*

**昨夜王宫的预言池显示，这件物品与即将到来的月蚀有关。强行占有或不当处置都可能引发灾难。**

*转向森林使者，微微欠身*

**您说得对，尊敬的林中智者。这件物品确实选择了出现的时机...但或许它选择的是我们三方共同面对这个考验的时刻。**
*缓缓抬起法杖，藤蔓上的叶片无风自动，发出沙沙声响*

**预言池的异动...**

*闭目片刻，兜帽下的微光忽明忽暗*

**我看到了...扭曲的月轮下，三条命运之线缠绕着这件物品。强行斩断任何一条，都会让阴影渗入现世。**

*突然睁开双眼，荧光蘑菇剧烈闪烁后化为灰烬*

*转向山地战士，藤蔓法杖轻点地面*

**铁与血的勇士啊，你可知道这件物品在梦境中向我展示的景象？它饮下的每一滴鲜血，都会在月蚀之夜化作百倍偿还的诅咒。**

*转向王国代表，从怀中取出一片发光的树叶*

**古老的'三圣试炼'确实记载在我们的树皮典籍上...但预言显示，这次必须加入第四项考验 - 牺牲。不是力量的牺牲，而是...**

*树叶突然燃烧起来，化作三只发光的蝴蝶分别飞向三方代表*

**每个势力必须献出最珍视之物：王国引以为傲的律法之书，山地部落传承千年的始祖战锤，以及...我们森林的永恒之种。**

*声音突然变得空灵，周围的树木开始无风摇曳*

**只有三件圣物齐聚，才能平息月蚀时物品的暴走。这是大地之灵刚刚告诉我的真相。**
*突然爆发出一阵震耳欲聋的大笑，笑声在山谷间回荡，惊起一群飞鸟*

**哈哈哈哈！好一个'牺牲'！森林的老树精终于说了句像样的话！**

*猛地将战斧插进地面，单膝跪地，铁甲碰撞发出铿锵声响*

*从腰间解下一把镶嵌着黑曜石的小锤，举过头顶*

**看好了！这就是我们山地部落的始祖战锤！从第一个熔炉中锻造出来的圣物！**

*突然站起身，胡须因激动而抖动*

**但要我们交出它？除非...**

*转向王国代表，眼中闪过狡黠的光芒*

**除非你们那些穿金戴银的贵族老爷真敢烧掉他们的律法书！那些条文可是比山里的矿石还硬！**

*大步走向魔法物品所在的位置，铁靴踏得地面咚咚作响*

**听着，软脚虾们！我有个更好的主意 - 既然都要献出圣物，不如先让这玩意儿认主！**

*突然用战斧划破手掌，让鲜血滴在魔法物品上*

**以先祖之血起誓！若它选择我，山地部落不仅献出战锤，还会用熔炉之焰为其他两方重铸圣物！**

*转身面对其他代表，沾血的手掌拍在胸前*

**这才叫真正的牺牲！不是放弃，而是重生！**
*迅速抬起法杖，一道翠绿色的屏障挡在魔法物品前，将鲜血隔绝在外*

**住手！莽撞的战士！**

*长袍无风自动，面色前所未有的严厉*

**你的血正在唤醒物品中沉睡的黑暗！看——**

*指向被鲜血溅到的地面，那里的草叶正以肉眼可见的速度枯萎发黑*

*深吸一口气，强迫自己恢复平静，转向其他代表时声音带着紧迫感*

**诸位，时间不多了。月蚀的阴影已经开始回应血腥的召唤。**

*从腰间解下一个镶嵌月光石的小瓶，倒出三滴银色液体在地上画出一个三角形*

**我以皇家顾问的名义提议：即刻开始改良版的三圣试炼。每个势力派出代表完成对应考验，但必须同时进行！**

*指向森林使者*

**智慧考验——解读物品上的古老铭文；**

*转向山地战士*

**力量考验——遏制物品散发出的黑暗能量；**

*最后指向自己*

**而王国将负责心灵考验——在试炼期间维持三方魔法的平衡。**

*突然从袖中抖落一本用白金锁链封住的厚重典籍，书封上的宝石正在不正常地跳动*

**看，律法之书已经对危机做出反应。王国愿意第一个做出牺牲——但必须是同步的牺牲！**

*用锐利的目光扫视众人*

**要么三方现在立刻同时行动，要么...**

*抬头望向已经开始泛红的天边*

**我们就要面对比月蚀更可怕的后果了。**
*法杖上的藤蔓突然疯狂生长，在众人周围形成一个发光的绿色结界，隔绝外界逐渐变红的月光*

**你们的争执惊醒了沉睡的恶兆...听！连风中的精灵都在尖叫逃窜！**

*突然扯下兜帽，露出布满发光纹路的面容，双眼完全变成翡翠色*

*用颤抖的手从怀中取出一颗跳动着绿光的种子，其光芒与律法书和始祖战锤产生共鸣*

**永恒之种...森林跳动的心脏...我以萨满之名将它献出。但记住——**

*将种子抛向三角形中心，它在空中分裂成三道光束分别射向三件圣物*

**这不是妥协，而是命运的必然！月蚀阴影已经爬上我的视野边缘！**

*突然单膝跪地，法杖插入地面，方圆十米的植物全部绽放出刺目的蓝光*

**山地之子！用你的战锤击打东方的结界点！王国智者！将律法书翻至第二百页！现在！**

*声音开始出现重音，仿佛多个声音同时在说话*

**黑暗在蠕动...我看到了...三圣物共鸣时...物品会显现真正的形态...快！**

*周围的树木开始扭曲变形，树皮上浮现出与魔法物品相同的符文*
*暴怒地扯断几根胡须，双眼因充血而通红，却反常地没有立即反驳*

**...哼！森林的疯婆子总算说了句人话！**

*突然转身，始祖战锤在手中旋转三圈后重重砸向东方结界点，冲击波震碎了方圆五米的岩石*

**山地人说到做到！但记住——**

*战锤与结界接触的瞬间迸发出熔岩般的红光，照亮了他狰狞的笑容*

**——等这事完了，我要亲手用熔炉重铸你们的圣物！到时候可别哭着说太烫！**

*一边维持着战锤的压力，一边斜眼瞥向王国代表*

**喂！穿长袍的！你那本破书再不动起来，我就把它和你的假发一起塞进熔炉里！**

*突然闷哼一声，战锤上的黑曜石开始出现裂纹*

**该死的...这玩意儿在吸食我的怒气！**

*咬破舌尖喷出一口血雾，血珠在空中燃烧成符文*

**以先祖之名——熔炉永不熄灭！**

*战锤突然迸发出刺目的金光，与另外两件圣物的光芒在魔法物品上方交织成光网*

*压低声音对森林使者吼道*

**老树精！你的预言最好靠谱...否则等月蚀结束，我要把你们的神树砍了当柴烧！**
*全身的发光纹路如同活物般游走，法杖深深插入地面，双手张开仿佛托举着无形的重担*

**愚蠢的熔炉之子...你的愤怒正在喂养黑暗！但...确实有效...**

*突然仰头发出一声不似人类的尖啸，周围的蓝光植物同时爆裂，释放出无数光点*

**三圣共鸣开始了！看——**

*魔法物品在三色光网中缓缓升起，表面开始剥落，露出内部跳动的核心——一颗被锁链缠绕的微型红月*

*声音突然变得虚弱，但依然坚持吟诵着古老的咒文*

**王国...律法书...翻到...预言篇章...森林的种子...连接生命之网...山地的战锤...击碎...虚伪的...**

*突然剧烈颤抖，法杖上的藤蔓开始焦黑枯萎*

**太快了...月蚀提前了...必须...完成...仪式...**

*用尽最后的力气将法杖折断，爆发的绿色能量注入三圣物形成的三角中心*

**以...永恒轮回之名...**

*倒下的瞬间，三道光束终于完全交汇，被锁链缠绕的红月核心开始剧烈脉动*

*用气若游丝的声音对山地战士说*

**现在...咆哮吧...熔炉之子...让始祖战锤的...最后一击...**

*伸手抓向空中飘落的灰烬*

**释放...被束缚的...新月...**
*双眼完全被红光充斥，肌肉暴涨撑裂了铁甲，却爆发出狂野的大笑*

**哈哈哈哈！这才像样！让那些躲在城堡和树洞里的懦夫们看看——什么才是真正的力量！**

*将裂纹密布的战锤抡过头顶，全身燃起实质化的怒气火焰*

**听着，老树精！这一锤下去，要么拯救世界——要么我们一起下地狱！**

*突然用战锤猛击自己胸口，喷出的鲜血在空气中燃烧成古老的符文*

**以始祖熔炉的十二道火焰起誓！山地部落的荣耀——**

*战锤带着雷霆万钧之势砸向悬浮的红月核心，冲击波瞬间掀翻了方圆百米的岩石*

**——永不熄灭！！！**

*在锤与月相撞的瞬间，时间仿佛静止。战锤彻底粉碎，释放出无数道金光刺入红月*

*单膝跪地，用残存的锤柄支撑身体，对着濒死的森林使者露出染血的狞笑*

**怎么样...老树精...这一锤...够不够...热烈...？**

*突然剧烈咳嗽，喷出的血沫在半空凝结成微型熔炉的形状*

**告诉你的精灵崽子们...这是...山地人的...牺牲...**

*用最后力气扯下颈间的黑曜石吊坠丢向光网中心*

**熔炉的...火种...拿去吧...但记住...**

*在失去意识前发出最后的咆哮*

**...活下来的混蛋...要给老子...立座像！！！**
```

The summarized and polished story looks like...

```plaintext
在三大势力交界的迷雾峡谷，命运之风裹挟着腐朽落叶与铁锈气息。当那件刻有月蚀纹路的魔法物品从裂开的地缝中升起时，王国的星象师听见了水晶球碎裂的脆响。

【森林的低语】
银纹萨满艾尔薇拉是最先抵达的，她法杖上的荧光蘑菇在阴影中绽开时，整片苔原突然绽放出星图般的蓝光。"这不是争夺，"她的声音带着千年古木的震颤，"被诅咒的新月正在苏醒。"兜帽滑落的瞬间，在场所有人都看见她眼角渗出的树液——那是森林子民流泪的方式。当山地战士的嗤笑震落松针时，她只是将永恒之种贴近心口，种子与心跳的共鸣让方圆十里的橡树同时垂下枝条。

【熔炉的咆哮】
格罗姆·铁砧的登场如同雪崩般粗暴。当刻着十二道火焰纹的始祖战锤砸进地面时，裂缝中喷出的却不是岩浆，而是黑如夜色的暗火。"懦夫才信预言！"他胡须里缠绕的熔岩符文随着怒吼亮起，却在看见魔法物品吞 噬鲜血的异变时突然沉默。这个曾单枪匹马屠龙的战士，此刻盯着自己正在腐化的左手，突然发出比战吼更令人战栗的大笑："好！够带劲！"他扯下祖传的黑曜石项链时，项链在他掌心熔化成滚烫的誓言。        

【律法的辉光】
皇家顾问阿尔方索的白金法典正在自行翻页，书页摩擦声像极了急促的呼吸。当他说出"同步牺牲"时，法典突然暴起锁链缠住他的手腕——这些由初代国王胡须锻造的律法锁链，此刻却在他苍白的皮肤上烙出"信任"的古体字。"以秩序之名，"他撕下预言篇章的动作优雅如舞剑，飘散的金粉却在空中组成哭泣的天使面容，"但有些秩序，必须用混乱来重建。"

【三圣共鸣】
当永恒之种扎入法典的羊皮纸，当战锤碎片的金光刺穿森林结界，峡谷中央升起的光柱里浮现出令星辰失色的景象：被锁链束缚的红月核心中，蜷缩着三个势力始祖的灵魂。艾尔薇拉的尖叫与格罗姆的大笑奇异地交融——他们同时认出了自己祖先扭曲的面容。阿尔方索的白金假发在能量风暴中燃烧，露出额头上与法典同款的锁链纹身。

【最后一锤】
格罗姆的最后一击不是用战锤，而是将自己化作人形熔炉撞向红月。在血肉与魔法核心融合的瞬间，人们清晰听见十二声锻打声——那是山地部落代代相传的铸魂秘技。艾尔薇拉折断的法杖突然生根，将她与正在消散的格罗姆相连，"看啊莽夫，"她沙哑的声音第一次带上温度，"你的熔炉...开出了花。"而阿尔方索跪在悬浮的法典上，用烧焦的手指写完了最后一条临时律法："今日起，牺牲成为最高美德。"

当纯净的新月从红壳中诞生时，三件圣物的残骸交织成横跨峡谷的虹桥。游吟诗人们后来传说，每当月蚀之夜，桥上会出现三个并肩而行的影子——一个踩着熔岩舞步，一个身后绽放花径，中间那个则在不断重写着发光的律令。而在三大势力的新盟约上，烙着奇特的印记：半朵蓝铃花，半把碎裂的战锤，中间缠绕着仍在燃烧的锁链。

（终章）
峡谷的石碑上刻着三行截然不同的文字：
"永恒轮回始于破碎"——森林符文
"痛快！"——山地部落的熔岩文
"第207条补充条例"——王国花体字
而在碑文下方，不知被谁用焦黑的手指画了座歪歪扭扭的雕像，雕像的胡须上挂着朵发光的蓝铃花。
```

## Acknowledgements

- This tiny toy project is inspired by the work of [BookWorld](https://arxiv.org/pdf/2504.14538).